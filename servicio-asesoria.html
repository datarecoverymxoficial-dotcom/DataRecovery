<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Asesor√≠a Preventiva ‚Äî Data Recovery</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Popup bonito (consistente con tus otras p√°ginas) */
    .popup-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.5); display: none; align-items: center; justify-content: center; z-index: 999; }
    .popup { background:#fff; border-radius:12px; padding:2em; text-align:center; max-width:350px; width:90%; box-shadow:0 4px 15px rgba(0,0,0,.2); animation: popupIn .3s ease; }
    .popup h2 { color:#2563eb; margin-bottom:.5em; }
    .popup p { color:#333; margin-bottom:1em; }
    .popup button { background:#2563eb; color:#fff; border:0; padding:.6em 1.2em; border-radius:6px; cursor:pointer; font-size:1em; }
    .popup button:hover { background:#1e4fd1; }
    @keyframes popupIn { from { transform:scale(.8); opacity:0; } to { transform:scale(1); opacity:1; } }

    /* Honeypot accesible y oculto */
    .hp-wrap { position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }
  </style>
</head>
<body>
<header class="site-header">
  <div class="container nav">
    <a class="brand" href="index.html">
      <img src="imagenes/logo.png" alt="" width="28" height="28">
      <span>Data Recovery</span>
    </a>
    <button class="nav-toggle" aria-expanded="false" aria-controls="menu">‚ò∞</button>
    <nav id="menu" class="menu" aria-label="Principal">
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="servicios.html" aria-current="page">Servicios</a></li>
        <li><a href="acerca.html">Acerca</a></li>
        <li><a href="contacto.html">Contacto</a></li>
      </ul>
    </nav>
  </div>
</header>

<main id="contenido">
  <section class="section">
    <div class="container">
      <h1>Asesor√≠a Preventiva</h1>
      <p class="lead" style="color:#1f2937;max-width:70ch">
        Te ayudamos a implementar buenas pr√°cticas de protecci√≥n y respaldo para que tu informaci√≥n
        siempre est√© segura y disponible. Incluye evaluaci√≥n de riesgos, plan de copias, pol√≠ticas
        de acceso y capacitaci√≥n b√°sica.
      </p>

      <div class="service-intro" style="margin-top:16px;">
        <article class="card">
          <h3>Costos orientativos</h3>
          <ul class="list">
            <li>Sesi√≥n individual 1:1: <strong>$600‚Äì$1,200 MXN</strong> por hora</li>
            <li>Paquete empresa (workshop): <strong>desde $3,000 MXN</strong></li>
            <li>Materiales y plantillas: incluidos</li>
          </ul>
          <p class="help">El costo depende de la duraci√≥n, modalidad y n√∫mero de participantes.</p>
        </article>
        <figure class="service-illustration">
          <img src="imagenes/serv_ase.png" alt="Asesor√≠a preventiva" loading="lazy" decoding="async">
        </figure>
      </div>

      <h3 style="margin-top:20px;">Solicita tu presupuesto</h3>
      <!-- Formspree + honeypot + origen + subject + estimado_texto -->
      <form class="form" id="form-presu" action="https://formspree.io/f/mnngoppk" method="POST">
        <!-- origen de la p√°gina -->
        <input type="hidden" name="origen" value="asesoria_preventiva">
        <!-- subject din√°mico (se completa en JS) -->
        <input type="hidden" name="_subject" id="subject-field" value="Solicitud: Asesor√≠a Preventiva">
        <!-- estimado en texto (se completa en JS) -->
        <input type="hidden" name="estimado_texto" id="estimado-field" value="">
        <!-- honeypot anti-spam -->
        <div class="hp-wrap" aria-hidden="true">
          <label>Dejar vac√≠o:
            <input type="text" name="campo_extra" tabindex="-1" autocomplete="off">
          </label>
        </div>

        <div class="grid-2">
          <label><span>Nombre</span><input name="nombre" required></label>
          <label><span>Correo</span><input name="correo" type="email" required></label>
        </div>

        <div class="grid-2">
          <label>
            <span>Tipo de asesor√≠a</span>
            <select name="tipo" required>
              <option value="individual">Individual (1:1)</option>
              <option value="empresa">Empresa (equipo/workshop)</option>
            </select>
          </label>
          <label>
            <span>Duraci√≥n</span>
            <select name="duracion" required>
              <option value="1h">1 hora</option>
              <option value="2h">2 horas</option>
              <option value="4h">4 horas</option>
            </select>
          </label>
        </div>

        <div class="grid-2">
          <label>
            <span>Modalidad</span>
            <select name="modalidad" required>
              <option value="remota">Remota</option>
              <option value="presencial">Presencial</option>
            </select>
          </label>
          <!-- üëá le a√±adimos ID para poder mostrar/ocultar -->
          <label id="grupo-participantes">
            <span>Participantes</span>
            <select name="personas" required>
              <option value="1">1 persona</option>
              <option value="2a5">2‚Äì5</option>
              <option value="6a15">6‚Äì15</option>
              <option value="16mas">16 o m√°s</option>
            </select>
          </label>
        </div>

        <label>
          <span>Comentarios</span>
          <textarea name="detalle" rows="4" placeholder="Objetivos, horarios, pol√≠ticas internas, nivel del equipo‚Ä¶"></textarea>
        </label>

        <p class="help" id="estimado-ayuda">Estimado: ‚Äî</p>
        <button class="btn primary" type="submit">Solicitar presupuesto</button>
      </form>
    </div>
    <div class="btn-center" style="margin-top:22px;">
      <a href="servicios.html" class="btn diagnostico">volver</a>
    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="container footer-grid">
    <div><strong>Data Recovery</strong><p>¬© <span id="year"></span></p></div>
    <nav aria-label="Secundario">
      <a href="index.html">Inicio</a>
      <a href="servicios.html" aria-current="page">Servicios</a>
      <a href="acerca.html">Acerca</a>
      <a href="contacto.html">Contacto</a>
    </nav>
  </div>
</footer>

<!-- Popup -->
<div class="popup-overlay" id="popup-overlay">
  <div class="popup">
    <h2>‚úÖ ¬°Solicitud enviada!</h2>
    <p>Gracias por contactarnos. Te enviaremos tu presupuesto pronto.</p>
    <button id="close-popup">Cerrar</button>
  </div>
</div>

<script>
  // Men√∫ m√≥vil
  const toggle=document.querySelector('.nav-toggle'), menu=document.getElementById('menu');
  toggle?.addEventListener('click',()=>{ const e=toggle.getAttribute('aria-expanded')==='true'; toggle.setAttribute('aria-expanded',String(!e)); menu.classList.toggle('open'); });
  document.getElementById('year').textContent=new Date().getFullYear();

  // ===== Estimador Asesor√≠a Preventiva =====
  const form=document.getElementById('form-presu');
  const ayuda=document.getElementById('estimado-ayuda');

  const tarifaHora = { individual: [600, 900], empresa: [900, 1200] };
  const factorDuracion = { "1h": 1.00, "2h": 1.90, "4h": 3.60 };
  const factorModalidad = { remota: 1.00, presencial: 1.20 };
  const factorPersonas = { "1": 1.00, "2a5": 1.15, "6a15": 1.30, "16mas": 1.55 };

  function calc(){
    const f = new FormData(form);
    const tipo = f.get('tipo'), dur = f.get('duracion'), mod = f.get('modalidad');

    // si es individual, fijamos "1" persona para el c√°lculo
    const ppl = (tipo === 'individual') ? '1' : f.get('personas');

    if(tarifaHora[tipo] && factorDuracion[dur] && factorModalidad[mod] && factorPersonas[ppl]){
      const [hMin, hMax] = tarifaHora[tipo];
      const min = Math.round(hMin * factorDuracion[dur] * factorModalidad[mod] * factorPersonas[ppl]);
      const max = Math.round(hMax * factorDuracion[dur] * factorModalidad[mod] * factorPersonas[ppl]);
      ayuda.textContent = `Estimado: $${min.toLocaleString()}‚Äì$${max.toLocaleString()} MXN (orientativo, incluye materiales).`;
    }
  }
  form?.addEventListener('change', calc);

  // ===== Mostrar/ocultar Participantes seg√∫n tipo =====
  const selTipo = document.querySelector('select[name="tipo"]');
  const grupoParticipantes = document.getElementById('grupo-participantes');
  const selParticipantes = grupoParticipantes?.querySelector('select[name="personas"]');

  function actualizarParticipantes(){
    if (selTipo.value === 'individual') {
      // ocultar y desactivar
      grupoParticipantes.style.display = 'none';
      if (selParticipantes) {
        selParticipantes.disabled = true;
        selParticipantes.removeAttribute('required'); // evitar validaci√≥n
        selParticipantes.value = '1'; // coherente con c√°lculo
      }
    } else {
      // mostrar y activar
      grupoParticipantes.style.display = '';
      if (selParticipantes) {
        selParticipantes.disabled = false;
        selParticipantes.setAttribute('required','required');
      }
    }
    calc(); // recalcular estimado al cambiar visibilidad
  }
  selTipo?.addEventListener('change', actualizarParticipantes);
  actualizarParticipantes(); // estado inicial

  // ===== Env√≠o a Formspree + popup + honeypot =====
  const popupOverlay=document.getElementById('popup-overlay');
  const closePopup=document.getElementById('close-popup');

  form?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const data = new FormData(form);

    // Bloquear bots (honeypot)
    if ((data.get('campo_extra') || '').toString().trim() !== '') return;

    // Subject din√°mico y estimado en oculto
    const tipo = data.get('tipo');
    const dur = data.get('duracion');
    const mod = data.get('modalidad');
    const ppl = (tipo === 'individual') ? '' : `, ${data.get('personas')}`;
    const est = (ayuda.textContent && ayuda.textContent.startsWith('Estimado')) ? ` | ${ayuda.textContent}` : '';
    const subject = `Solicitud: Asesor√≠a (${tipo}, ${dur}, ${mod}${ppl})${est}`;

    document.getElementById('subject-field').value = subject;
    document.getElementById('estimado-field').value = ayuda.textContent || '';

    try {
      const response = await fetch(form.action, {
        method: form.method,
        body: data,
        headers: { 'Accept': 'application/json' }
      });
      if (response.ok) {
        popupOverlay.style.display='flex';
        form.reset();
        ayuda.textContent='Estimado: ‚Äî';
        actualizarParticipantes(); // deja el estado consistente tras reset
      } else {
        alert("‚ùå Ocurri√≥ un error al enviar el formulario. Int√©ntalo de nuevo.");
      }
    } catch (error) {
      alert("‚ö†Ô∏è No se pudo conectar con el servidor. Revisa tu conexi√≥n e intenta m√°s tarde.");
    }
  });

  // Cerrar popup
  closePopup.addEventListener('click',()=>popupOverlay.style.display='none');
  popupOverlay.addEventListener('click',e=>{ if(e.target===popupOverlay) popupOverlay.style.display='none'; });
</script>
</body>
</html>
