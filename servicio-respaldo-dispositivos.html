<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sistemas de Respaldo en Dispositivos — Data Recovery</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* === Popup bonito (consistente con las otras páginas) === */
    .popup-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 999; }
    .popup { background: #fff; border-radius: 12px; padding: 2em; text-align: center; max-width: 350px; width: 90%; box-shadow: 0 4px 15px rgba(0,0,0,0.2); animation: popupIn .3s ease; }
    .popup h2 { color: #2563eb; margin-bottom: .5em; }
    .popup p  { color: #333; margin-bottom: 1em; }
    .popup button { background:#2563eb; color:#fff; border:0; padding:.6em 1.2em; border-radius:6px; cursor:pointer; font-size:1em; }
    .popup button:hover { background:#1e4fd1; }
    @keyframes popupIn { from { transform: scale(.8); opacity:0; } to { transform: scale(1); opacity:1; } }

    /* Honeypot oculto y accesible */
    .hp-wrap { position: absolute; left: -9999px; width:1px; height:1px; overflow:hidden; }
  </style>
</head>
<body>
<header class="site-header">
  <div class="container nav">
    <a class="brand" href="index.html">
      <img src="imagenes/logo.png" alt="" width="28" height="28">
      <span>Data Recovery</span>
    </a>
    <button class="nav-toggle" aria-expanded="false" aria-controls="menu">☰</button>
    <nav id="menu" class="menu" aria-label="Principal">
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="servicios.html" aria-current="page">Servicios</a></li>
        <li><a href="acerca.html">Acerca</a></li>
        <li><a href="contacto.html">Contacto</a></li>
      </ul>
    </nav>
  </div>
</header>

<main id="contenido">
  <section class="section">
    <div class="container">
      <h1>Sistemas de Respaldo en Dispositivos</h1>
      <p class="lead" style="color:#1f2937;max-width:70ch">
        Instalamos soluciones de respaldo en discos externos y servidores NAS, para que siempre tengas una copia segura de tu información más importante.
        Configuramos programación automática, versiones de archivos y alertas, con acceso seguro en tu red local.
      </p>

      <div class="service-intro" style="margin-top:16px;">
        <article class="card">
          <h3>Costos orientativos</h3>
          <ul class="list">
            <li>Diagnóstico y propuesta: <strong>$0</strong> (gratuito)</li>
            <li>Setup con <em>disco externo</em>: <strong>$1,500–$2,500 MXN</strong> (no incluye hardware)</li>
            <li>Setup con <em>NAS</em> (red local): <strong>$3,000–$6,000 MXN</strong> (no incluye hardware)</li>
            <li>Mantenimiento mensual (opcional): <strong>$350–$1,200 MXN</strong> según usuarios/alertas</li>
          </ul>
          <p class="help">El costo depende del número de equipos, volumen de datos y políticas de versiones. El hardware (discos/NAS) se cotiza por separado.</p>
        </article>
        <figure class="service-illustration">
          <img src="imagenes/serv_res_d.png" alt="Sistemas de respaldo en dispositivos" loading="lazy" decoding="async">
        </figure>
      </div>

      <h3 style="margin-top:20px;">Solicita tu presupuesto</h3>
      <!-- Form con Formspree + honeypot + origen -->
      <form class="form" id="form-presu"
            action="https://formspree.io/f/mnngoppk"
            method="POST">
        <!-- Origen para identificar esta página -->
        <input type="hidden" name="origen" value="respaldo_dispositivos">
        <!-- (Opcional) subject dinámico — se completa en JS -->
        <input type="hidden" name="_subject" id="subject-field" value="Solicitud: Sistemas de Respaldo">

        <!-- Honeypot anti-spam -->
        <div class="hp-wrap" aria-hidden="true">
          <label>Dejar vacío:
            <input type="text" name="campo_extra" tabindex="-1" autocomplete="off">
          </label>
        </div>

        <div class="grid-2">
          <label><span>Nombre</span><input name="nombre" required></label>
          <label><span>Correo</span><input name="correo" type="email" required></label>
        </div>

        <div class="grid-2">
          <label>
            <span>Tipo de solución</span>
            <select name="tipo" required>
              <option value="disco">Disco externo (USB)</option>
              <option value="nas">Servidor NAS (red local)</option>
            </select>
          </label>
          <label>
            <span>Número de usuarios/equipos</span>
            <select name="usuarios" required>
              <option value="1a3">1–3</option>
              <option value="4a10">4–10</option>
              <option value="11a25">11–25</option>
              <option value="26mas">26 o más</option>
            </select>
          </label>
        </div>

        <div class="grid-2">
          <label>
            <span>Volumen de datos</span>
            <select name="volumen" required>
              <option value="menos500">Menos de 500 GB</option>
              <option value="500a2000">500 GB–2 TB</option>
              <option value="mas2000">Más de 2 TB</option>
            </select>
          </label>
          <label>
            <span>Mantenimiento mensual</span>
            <select name="manto" required>
              <option value="no">Sin mantenimiento</option>
              <option value="basico">Básico (monitoreo y respaldo)</option>
              <option value="avanzado">Avanzado (alertas + soporte)</option>
            </select>
          </label>
        </div>

        <label>
          <span>Comentarios</span>
          <textarea name="detalle" rows="4" placeholder="Horarios, políticas de versiones, cifrado, acceso remoto…"></textarea>
        </label>

        <p class="help" id="estimado-ayuda">Estimado: —</p>
        <button class="btn primary" type="submit">Solicitar presupuesto</button>
      </form>
    </div>
    <div class="btn-center" style="margin-top:22px;">
      <a href="servicios.html" class="btn diagnostico">Volver</a>
    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="container footer-grid">
    <div><strong>Data Recovery</strong><p>© <span id="year"></span></p></div>
    <nav aria-label="Secundario">
      <a href="index.html">Inicio</a>
      <a href="servicios.html" aria-current="page">Servicios</a>
      <a href="acerca.html">Acerca</a>
      <a href="contacto.html">Contacto</a>
    </nav>
  </div>
</footer>

<!-- Popup -->
<div class="popup-overlay" id="popup-overlay">
  <div class="popup">
    <h2>✅ ¡Solicitud enviada!</h2>
    <p>Gracias por contactarnos. Te enviaremos tu presupuesto pronto.</p>
    <button id="close-popup">Cerrar</button>
  </div>
</div>

<script>
  // Menú móvil
  const toggle=document.querySelector('.nav-toggle');
  const menu=document.getElementById('menu');
  toggle?.addEventListener('click',()=>{
    const e=toggle.getAttribute('aria-expanded')==='true';
    toggle.setAttribute('aria-expanded',String(!e));
    menu.classList.toggle('open');
  });
  document.getElementById('year').textContent=new Date().getFullYear();

  // ===== Estimador (setup + mantenimiento) =====
  const form=document.getElementById('form-presu');
  const ayuda=document.getElementById('estimado-ayuda');

  // Setup base por tipo de solución
  const setupBase = {
    disco: [1500, 2500],
    nas:   [3000, 6000]
  };

  // Multiplicadores por número de usuarios/equipos
  const factorUsuarios = {
    "1a3":   1.00,
    "4a10":  1.20,
    "11a25": 1.40,
    "26mas": 1.70
  };

  // Ajuste por volumen
  const factorVolumen = {
    menos500:   1.00,
    "500a2000": 1.15,
    mas2000:    1.30
  };

  // Mantenimiento mensual (opcional)
  const mantoMensual = {
    no:       [0, 0],
    basico:   [350, 600],
    avanzado: [800, 1200]
  };

  function calc(){
    const f=new FormData(form);
    const tipo   = f.get('tipo');
    const usuarios = f.get('usuarios');
    const volumen  = f.get('volumen');
    const manto    = f.get('manto');

    if(setupBase[tipo] && factorUsuarios[usuarios] && factorVolumen[volumen] && mantoMensual[manto]){
      const [minBase, maxBase] = setupBase[tipo];
      const fu = factorUsuarios[usuarios], fv = factorVolumen[volumen];
      const [mMin, mMax] = mantoMensual[manto];

      const minSetup = Math.round(minBase * fu * fv);
      const maxSetup = Math.round(maxBase * fu * fv);

      let texto = `Setup estimado: $${minSetup.toLocaleString()}–$${maxSetup.toLocaleString()} MXN`;
      if(mMax > 0){
        texto += ` + mantenimiento: $${mMin.toLocaleString()}–$${mMax.toLocaleString()} MXN/mes.`;
      } else {
        texto += `.`;
      }
      texto += " (Orientativo; no incluye hardware).";
      ayuda.textContent = texto;
    }
  }
  form?.addEventListener('change', calc);

  // ===== Envío a Formspree + popup + honeypot =====
  const popupOverlay=document.getElementById('popup-overlay');
  const closePopup=document.getElementById('close-popup');

  form?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const data = new FormData(form);

    // Bloquear bots por honeypot
    if ((data.get('campo_extra') || '').toString().trim() !== '') return;

    // Armar subject con parámetros y estimado si existe
    const subject = (() => {
      const tipo = data.get('tipo');
      const usuarios = data.get('usuarios');
      const volumen = data.get('volumen');
      const manto = data.get('manto');
      const est = ayuda.textContent && ayuda.textContent.includes('Setup estimado') ? ` | ${ayuda.textContent}` : '';
      return `Solicitud: Respaldo (${tipo}, ${usuarios}, ${volumen}, manto:${manto})${est}`;
    })();
    const subjField = document.getElementById('subject-field');
    if (subjField) subjField.value = subject;

    try {
      const response = await fetch(form.action, {
        method: form.method,
        body: data,
        headers: { 'Accept': 'application/json' }
      });
      if (response.ok) {
        popupOverlay.style.display='flex';
        form.reset();
        ayuda.textContent='Estimado: —';
      } else {
        alert("❌ Ocurrió un error al enviar el formulario. Inténtalo de nuevo.");
      }
    } catch (error) {
      alert("⚠️ No se pudo conectar con el servidor. Revisa tu conexión e intenta más tarde.");
    }
  });

  // Cerrar popup
  closePopup.addEventListener('click',()=>popupOverlay.style.display='none');
  popupOverlay.addEventListener('click',e=>{ if(e.target===popupOverlay) popupOverlay.style.display='none'; });
</script>
</body>
</html>
